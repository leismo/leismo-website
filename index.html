<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leismo - Fashion Loyalty System</title>
    <!-- Add Leismo HTML website -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .logo-font {
            font-family: 'Playfair Display', serif;
            font-weight: 300;
            letter-spacing: 4px;
            text-transform: lowercase;
        }
        .brand-color { color: #B19D87; }
        .brand-bg { background-color: #B19D87; }
        .brand-border { border-color: #B19D87; }
        .secondary-bg { background-color: #DACFBD; }
        .secondary-border { border-color: #DACFBD; }
        .gradient-bg {
            background: linear-gradient(to right, #B19D87, #DACFBD);
        }
        .hidden { display: none; }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-40 border-b secondary-border">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center gap-8">
                    <div class="text-2xl cursor-pointer brand-color logo-font" onclick="showPage('home')">
                        leismo
                    </div>
                    <nav class="hidden md:flex gap-6">
                        <button onclick="showPage('home')" class="font-medium transition-colors text-gray-700 hover:opacity-75" id="nav-home">
                            ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                        </button>
                        <button onclick="showPage('loyalty')" class="font-medium transition-colors text-gray-700 hover:opacity-75 flex items-center gap-2 hidden" id="nav-loyalty">
                            <span>‚≠ê</span>
                            Loyalty Card
                        </button>
                    </nav>
                </div>
                
                <div class="flex items-center gap-4" id="header-auth">
                    <div class="flex gap-4" id="auth-buttons">
                        <button onclick="showPage('login')" class="hover:opacity-90 transition-colors font-light brand-color">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                        <button onclick="showPage('register')" class="bg-transparent border px-4 py-2 rounded-full hover:bg-opacity-10 transition-colors brand-color brand-border">
                            ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                        </button>
                    </div>
                    
                    <div class="flex items-center gap-4 hidden" id="user-info">
                        <div class="flex items-center gap-2 text-sm brand-color">
                            <span>‚≠ê</span>
                            <span id="user-points">0</span>
                        </div>
                        <span class="hidden sm:inline brand-color" id="user-name"></span>
                        <button onclick="logout()" class="hover:opacity-90 transition-colors font-light brand-color">
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Home Page -->
        <div id="page-home" class="min-h-screen flex items-center justify-center gradient-bg">
            <div class="text-center px-4">
                <div class="mb-12">
                    <div class="text-5xl cursor-pointer text-white logo-font mx-auto">
                        leismo
                    </div>
                </div>
                
                <p class="text-xl mb-12 text-white font-light tracking-wide max-w-md mx-auto">
                    ‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡πÑ‡∏ï‡∏•‡πå
                </p>
                
                <div class="space-y-4">
                    <div>
                        <button class="bg-white px-12 py-4 rounded-full font-semibold text-lg hover:bg-opacity-90 transition-colors shadow-lg brand-color">
                            ‡∏î‡∏π‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏Å‡∏ä‡∏±‡∏ô
                        </button>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-4 justify-center" id="home-auth-buttons">
                        <button onclick="showPage('login')" class="border-2 border-white text-white px-8 py-3 rounded-full font-semibold hover:bg-white hover:text-gray-800 transition-colors">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                        
                        <button onclick="showPage('register')" class="bg-white px-8 py-3 rounded-full font-semibold hover:bg-opacity-90 transition-colors brand-color">
                            ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                        </button>
                    </div>

                    <div class="hidden" id="home-loyalty-button">
                        <button onclick="showPage('loyalty')" class="bg-yellow-500 text-white px-8 py-3 rounded-full font-semibold hover:bg-yellow-600 transition-colors shadow-lg">
                            <span class="inline-block mr-2">‚≠ê</span>
                            ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å Loyalty
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Page -->
        <div id="page-login" class="hidden min-h-screen flex items-center justify-center py-12 px-4" style="background: linear-gradient(to bottom right, #DACFBD, #B19D87)">
            <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md border brand-border">
                <div class="text-center mb-6">
                    <div class="text-3xl cursor-pointer brand-color logo-font mx-auto mb-4" onclick="showPage('home')">
                        leismo
                    </div>
                    <h2 class="text-2xl font-bold tracking-wide brand-color">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                </div>
                
                <div id="login-error" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"></div>
                
                <form onsubmit="handleLogin(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2 brand-color">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" id="login-email" required class="w-full p-3 border rounded-lg focus:ring-2 focus:border-transparent font-light secondary-border" placeholder="admin@leismo.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 brand-color">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="login-password" required class="w-full p-3 border rounded-lg focus:ring-2 focus:border-transparent font-light secondary-border" placeholder="admin123">
                    </div>
                    
                    <button type="submit" class="w-full text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors shadow-lg brand-bg" id="login-submit">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </form>
                
                <p class="text-center mt-4 text-gray-600 font-light">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <button onclick="showPage('register')" class="hover:underline brand-color">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                </p>
                
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <p class="text-sm text-blue-800 font-semibold">üí° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö Admin:</p>
                    <p class="text-xs text-blue-600">Email: admin@leismo.com</p>
                    <p class="text-xs text-blue-600">Password: admin123</p>
                </div>
            </div>
        </div>

        <!-- Register Page -->
        <div id="page-register" class="hidden min-h-screen flex items-center justify-center py-12 px-4" style="background: linear-gradient(to bottom right, #DACFBD, #B19D87)">
            <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md border brand-border">
                <div class="text-center mb-6">
                    <div class="text-3xl cursor-pointer brand-color logo-font mx-auto mb-4" onclick="showPage('home')">
                        leismo
                    </div>
                    <h2 class="text-2xl font-bold tracking-wide brand-color">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
                </div>
                
                <div id="register-error" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"></div>
                
                <form onsubmit="handleRegister(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2 brand-color">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                        <input type="text" id="register-name" required class="w-full p-3 border rounded-lg focus:ring-2 focus:border-transparent font-light secondary-border" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 brand-color">‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                        <input type="email" id="register-email" required class="w-full p-3 border rounded-lg focus:ring-2 focus:border-transparent font-light secondary-border" placeholder="example@email.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 brand-color">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô *</label>
                        <input type="password" id="register-password" required minlength="6" class="w-full p-3 border rounded-lg focus:ring-2 focus:border-transparent font-light secondary-border" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 brand-color">‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î *</label>
                        <input type="date" id="register-birthdate" required class="w-full p-3 border rounded-lg focus:ring-2 focus:border-transparent font-light secondary-border">
                        <p class="text-xs text-gray-500 mt-1">üéâ ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</p>
                    </div>
                    
                    <button type="submit" class="w-full text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-colors shadow-lg brand-bg" id="register-submit">
                        ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                    </button>
                </form>
                
                <p class="text-center mt-4 text-gray-600 font-light">
                    ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <button onclick="showPage('login')" class="hover:underline brand-color">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </p>
            </div>
        </div>

        <!-- Loyalty Page -->
        <div id="page-loyalty" class="hidden min-h-screen py-8 px-4 secondary-bg">
            <div class="container mx-auto max-w-6xl">
                <div class="bg-white rounded-lg shadow-lg p-6 md:p-8 border mb-8 brand-border">
                    <h1 class="text-2xl md:text-3xl font-bold mb-6 tracking-wide brand-color">
                        ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ <span id="loyalty-user-name"></span>
                    </h1>
                    <p class="text-lg mb-8 brand-color">
                        ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <span id="loyalty-user-tier"></span> | <span id="loyalty-user-points"></span> ‡πÅ‡∏ï‡πâ‡∏°
                    </p>

                    <!-- Navigation Tabs -->
                    <div class="flex flex-col sm:flex-row border-b mb-8 overflow-x-auto">
                        <button onclick="showLoyaltyTab('dashboard')" class="loyalty-tab flex-1 flex items-center justify-center gap-2 py-4 px-6 font-semibold transition-colors whitespace-nowrap border-b-2 brand-color" style="border-color: #B19D87">
                            <span>‚≠ê</span>
                            ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                        </button>
                        <button onclick="showLoyaltyTab('rewards')" class="loyalty-tab flex-1 flex items-center justify-center gap-2 py-4 px-6 font-semibold transition-colors whitespace-nowrap hover:bg-gray-50" style="color: #6B7280; border-color: transparent">
                            <span>üéÅ</span>
                            ‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
                        </button>
                        <button onclick="showLoyaltyTab('coupons')" class="loyalty-tab flex-1 flex items-center justify-center gap-2 py-4 px-6 font-semibold transition-colors whitespace-nowrap hover:bg-gray-50" style="color: #6B7280; border-color: transparent">
                            <span>üèÜ</span>
                            ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div id="loyalty-dashboard" class="loyalty-content">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center p-6 rounded-lg secondary-bg">
                                <div class="text-6xl mb-4">üèÜ</div>
                                <h3 class="text-xl font-semibold mb-2 brand-color">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                                <p class="text-2xl font-bold brand-color" id="dashboard-tier">Bronze</p>
                            </div>
                            
                            <div class="text-center p-6 rounded-lg secondary-bg">
                                <div class="text-6xl mb-4">‚≠ê</div>
                                <h3 class="text-xl font-semibold mb-2 brand-color">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°</h3>
                                <p class="text-2xl font-bold brand-color" id="dashboard-points">0</p>
                            </div>
                            
                            <div class="text-center p-6 rounded-lg secondary-bg">
                                <div class="text-6xl mb-4">üéÅ</div>
                                <h3 class="text-xl font-semibold mb-2 brand-color">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ</h3>
                                <p class="text-2xl font-bold brand-color" id="dashboard-coupons">0</p>
                            </div>
                        </div>
                    </div>

                    <div id="loyalty-rewards" class="loyalty-content hidden">
                        <h3 class="text-xl font-semibold mb-6 text-center brand-color">
                            ‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rewards-container">
                            <!-- Rewards will be populated by JavaScript -->
                        </div>
                    </div>

                    <div id="loyalty-coupons" class="loyalty-content hidden">
                        <h3 class="text-xl font-semibold mb-6 text-center brand-color">
                            ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                        </h3>
                        
                        <div id="coupons-container">
                            <!-- Coupons will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="mt-8 p-6 bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-lg">
                        <h3 class="text-xl font-semibold mb-4 brand-color">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Loyalty Card</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700">
                            <li>‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á Line Shopping ‡∏´‡∏£‡∏∑‡∏≠ Lazada</li>
                            <li>‡∏ô‡∏≥‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏°‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</li>
                            <li>‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</li>
                            <li>‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏ã‡∏∑‡πâ‡∏≠ (1 ‡πÅ‡∏ï‡πâ‡∏°/100 ‡∏ö‡∏≤‡∏ó)</li>
                            <li><strong>‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</strong></li>
                            <li><strong>‡∏ô‡∏≥‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô</strong></li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="hidden min-h-screen flex items-center justify-center secondary-bg">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4" style="border-color: #B19D87"></div>
                <p class="brand-color">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>
    </main>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXGkArdsTGXW58iqIas3c9dodTWv0hVuE",
            authDomain: "leismo-website-8f6b0.firebaseapp.com",
            projectId: "leismo-website-8f6b0",
            storageBucket: "leismo-website-8f6b0.firebasestorage.app",
            messagingSenderId: "1085891529571",
            appId: "1:1085891529571:web:9125f49c54ea1de9b96156",
            measurementId: "G-FZQ92YJ9ZN"
        };

        // State Management
        let currentUser = null;
        let isLoggedIn = false;
        let users = [];

        // Rewards Data
        const rewards = [
            { id: 1, name: '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 100‡∏ø', points: 500, type: 'coupon', value: 100 },
            { id: 2, name: '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 250‡∏ø', points: 1000, type: 'coupon', value: 250 },
            { id: 3, name: '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 500‡∏ø', points: 2000, type: 'coupon', value: 500 },
            { id: 4, name: '‡∏ü‡∏£‡∏µ‡∏™‡πà‡∏á (‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ 50‡∏ø)', points: 300, type: 'coupon', value: 50 },
            { id: 5, name: '‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 15% (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 300‡∏ø)', points: 1500, type: 'percent', value: 15, maxDiscount: 300 }
        ];

        // Utility Functions
        function hashPassword(password) {
            return btoa(password + 'leismo_salt');
        }

        function verifyPassword(inputPassword, hashedPassword) {
            return hashPassword(inputPassword) === hashedPassword;
        }

        function generateCouponCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = 'LEISMO';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function saveToStorage() {
            localStorage.setItem('leismo_users', JSON.stringify(users));
            if (currentUser) {
                localStorage.setItem('leismo_current_user', JSON.stringify(currentUser));
            } else {
                localStorage.removeItem('leismo_current_user');
            }
        }

        function loadFromStorage() {
            try {
                const usersData = localStorage.getItem('leismo_users');
                const currentUserData = localStorage.getItem('leismo_current_user');
                
                if (usersData) {
                    users = JSON.parse(usersData);
                }
                
                if (currentUserData) {
                    currentUser = JSON.parse(currentUserData);
                    isLoggedIn = true;
                    updateAuthUI();
                }

                // Add admin default if not exists
                const hasAdmin = users.some(u => u.email === 'admin@leismo.com');
                if (!hasAdmin) {
                    const adminUser = {
                        id: 'admin_001',
                        name: 'Admin Leismo',
                        email: 'admin@leismo.com',
                        password: hashPassword('admin123'),
                        points: 99999,
                        tier: 'Platinum',
                        isAdmin: true,
                        coupons: [],
                        createdAt: new Date().toISOString()
                    };
                    users.push(adminUser);
                    saveToStorage();
                }
            } catch (error) {
                console.error('Error loading from storage:', error);
            }
        }

        // Page Navigation
        function showPage(pageName) {
            // Hide all pages
            const pages = ['home', 'login', 'register', 'loyalty'];
            pages.forEach(page => {
                document.getElementById(`page-${page}`).classList.add('hidden');
            });

            // Show selected page
            document.getElementById(`page-${pageName}`).classList.remove('hidden');

            // Update navigation
            updateNavigation(pageName);

            // Special handling for loyalty page
            if (pageName === 'loyalty') {
                if (!isLoggedIn) {
                    showPage('login');
                    return;
                }
                updateLoyaltyPage();
            }
        }

        function updateNavigation(currentPage) {
            const navHome = document.getElementById('nav-home');
            const navLoyalty = document.getElementById('nav-loyalty');

            // Reset colors
            navHome.style.color = currentPage === 'home' ? '#B19D87' : '#6B7280';
            if (navLoyalty) {
                navLoyalty.style.color = currentPage === 'loyalty' ? '#B19D87' : '#6B7280';
            }
        }

        function updateAuthUI() {
            const authButtons = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            const navLoyalty = document.getElementById('nav-loyalty');
            const homeAuthButtons = document.getElementById('home-auth-buttons');
            const homeLoyaltyButton = document.getElementById('home-loyalty-button');

            if (isLoggedIn && currentUser) {
                // Header
                authButtons.classList.add('hidden');
                userInfo.classList.remove('hidden');
                navLoyalty.classList.remove('hidden');
                
                // Update user info
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-points').textContent = currentUser.points?.toLocaleString() || '0';

                // Home page
                homeAuthButtons.classList.add('hidden');
                homeLoyaltyButton.classList.remove('hidden');
            } else {
                // Header
                authButtons.classList.remove('hidden');
                userInfo.classList.add('hidden');
                navLoyalty.classList.add('hidden');

                // Home page
                homeAuthButtons.classList.remove('hidden');
                homeLoyaltyButton.classList.add('hidden');
            }
        }

        // Authentication Functions
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const submitBtn = document.getElementById('login-submit');
            const errorDiv = document.getElementById('login-error');

            if (!email || !password) {
                showError('login-error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
                return;
            }

            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...';
            submitBtn.disabled = true;

            try {
                const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
                
                if (!user) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ');
                }

                if (!verifyPassword(password, user.password)) {
                    throw new Error('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }

                currentUser = { ...user };
                delete currentUser.password;
                isLoggedIn = true;
                
                saveToStorage();
                updateAuthUI();
                hideError('login-error');
                
                alert('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                showPage('home');
                
            } catch (error) {
                showError('login-error', error.message);
            } finally {
                submitBtn.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                submitBtn.disabled = false;
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const birthDate = document.getElementById('register-birthdate').value;
            const submitBtn = document.getElementById('register-submit');

            if (!name || !email || !password || !birthDate) {
                showError('register-error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            if (password.length < 6) {
                showError('register-error', '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                return;
            }

            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£...';
            submitBtn.disabled = true;

            try {
                const existingUser = users.find(u => u.email.toLowerCase() === email.toLowerCase());
                if (existingUser) {
                    throw new Error('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß');
                }

                const newUser = {
                    id: 'user_' + Date.now(),
                    name: name,
                    email: email.toLowerCase(),
                    password: hashPassword(password),
                    birthDate: birthDate,
                    points: 100,
                    tier: 'Bronze',
                    coupons: [],
                    isAdmin: false,
                    createdAt: new Date().toISOString()
                };

                users.push(newUser);
                currentUser = { ...newUser };
                delete currentUser.password;
                isLoggedIn = true;

                saveToStorage();
                updateAuthUI();
                hideError('register-error');
                
                alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Leismo');
                showPage('home');
                
            } catch (error) {
                showError('register-error', error.message);
            } finally {
                submitBtn.textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
                submitBtn.disabled = false;
            }
        }

        function logout() {
            currentUser = null;
            isLoggedIn = false;
            localStorage.removeItem('leismo_current_user');
            updateAuthUI();
            showPage('home');
        }

        function showError(elementId, message) {
            const errorDiv = document.getElementById(elementId);
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError(elementId) {
            const errorDiv = document.getElementById(elementId);
            errorDiv.classList.add('hidden');
        }

        // Loyalty Page Functions
        function showLoyaltyTab(tabName) {
            // Hide all tab content
            const contents = document.querySelectorAll('.loyalty-content');
            contents.forEach(content => content.classList.add('hidden'));

            // Show selected tab content
            document.getElementById(`loyalty-${tabName}`).classList.remove('hidden');

            // Update tab buttons
            const tabs = document.querySelectorAll('.loyalty-tab');
            tabs.forEach(tab => {
                tab.style.color = '#6B7280';
                tab.style.borderColor = 'transparent';
                tab.classList.remove('border-b-2');
            });

            // Highlight active tab
            event.target.style.color = '#B19D87';
            event.target.style.borderColor = '#B19D87';
            event.target.classList.add('border-b-2');

            // Load specific tab content
            if (tabName === 'rewards') {
                loadRewards();
            } else if (tabName === 'coupons') {
                loadCoupons();
            }
        }

        function updateLoyaltyPage() {
            if (!currentUser) return;

            document.getElementById('loyalty-user-name').textContent = currentUser.name;
            document.getElementById('loyalty-user-tier').textContent = currentUser.tier;
            document.getElementById('loyalty-user-points').textContent = currentUser.points?.toLocaleString() || '0';

            // Update dashboard
            document.getElementById('dashboard-tier').textContent = currentUser.tier;
            document.getElementById('dashboard-points').textContent = currentUser.points?.toLocaleString() || '0';
            document.getElementById('dashboard-coupons').textContent = (currentUser.coupons || []).filter(c => !c.used).length;

            // Show dashboard tab by default
            showLoyaltyTab('dashboard');
        }

        function loadRewards() {
            const container = document.getElementById('rewards-container');
            container.innerHTML = '';

            rewards.forEach(reward => {
                const canRedeem = currentUser && currentUser.points >= reward.points;
                const rewardDiv = document.createElement('div');
                rewardDiv.className = 'border rounded-lg p-6 text-center hover:shadow-lg transition-shadow';
                rewardDiv.style.borderColor = '#DACFBD';

                rewardDiv.innerHTML = `
                    <div class="mb-4">
                        <div class="text-6xl">üéÅ</div>
                    </div>
                    
                    <h4 class="font-semibold mb-2 brand-color">${reward.name}</h4>
                    <p class="text-2xl font-bold mb-4 brand-color">
                        ${reward.points.toLocaleString()} ‡πÅ‡∏ï‡πâ‡∏°
                    </p>
                    
                    <button onclick="redeemReward(${reward.id})" 
                            ${!canRedeem ? 'disabled' : ''} 
                            class="w-full py-2 rounded-lg font-semibold transition-colors ${canRedeem ? 'text-white hover:opacity-90 brand-bg' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}">
                        ${canRedeem ? '‡πÅ‡∏•‡∏Å‡πÄ‡∏•‡∏¢' : '‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠'}
                    </button>
                `;

                container.appendChild(rewardDiv);
            });
        }

        function loadCoupons() {
            const container = document.getElementById('coupons-container');
            const userCoupons = currentUser?.coupons || [];

            if (userCoupons.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-8xl mb-4">üéÅ</div>
                        <p class="text-gray-500 text-lg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</p>
                        <p class="text-gray-400">‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '<div class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>';
            const grid = container.querySelector('.grid');

            userCoupons.forEach(coupon => {
                const couponDiv = document.createElement('div');
                couponDiv.className = `border rounded-lg p-6 ${coupon.used ? 'opacity-50 bg-gray-50' : 'bg-white border-dashed'}`;
                couponDiv.style.borderColor = coupon.used ? '#ccc' : '#B19D87';

                couponDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-bold text-lg brand-color">${coupon.name}</h4>
                            <p class="text-sm text-gray-600">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${coupon.createdDate}</p>
                            <p class="text-sm text-gray-600">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: ${coupon.expiryDate}</p>
                        </div>
                        <div class="text-right">
                            ${coupon.type === 'coupon' ? 
                                `<p class="text-3xl font-bold brand-color">‡∏ø${coupon.value}</p>` : 
                                `<p class="text-3xl font-bold brand-color">${coupon.value}%</p>`
                            }
                        </div>
                    </div>
                    
                    <div class="bg-gray-100 p-3 rounded text-center mb-4">
                        <p class="text-sm text-gray-600 mb-1">‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á:</p>
                        <p class="text-lg font-mono font-bold tracking-wider brand-color">${coupon.code}</p>
                    </div>

                    <div class="text-center py-2 px-4 rounded-full text-sm font-semibold ${coupon.used ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">
                        ${coupon.used ? '‚úì ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß' : 'üé´ ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ'}
                    </div>

                    ${!coupon.used ? `
                        <div class="mt-4 text-sm text-gray-600">
                            <p>üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong></p>
                            <p>‚Ä¢ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î "${coupon.code}"</p>
                            <p>‚Ä¢ ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà Line Shopping ‡∏´‡∏£‡∏∑‡∏≠ Lazada</p>
                            <p>‚Ä¢ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î</p>
                        </div>
                    ` : ''}
                `;

                grid.appendChild(couponDiv);
            });
        }

        function redeemReward(rewardId) {
            if (!currentUser) return;

            const reward = rewards.find(r => r.id === rewardId);
            if (!reward) return;

            if (currentUser.points < reward.points) {
                alert('‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ô‡∏µ‡πâ');
                return;
            }

            const couponCode = generateCouponCode();
            const newCoupon = {
                id: Date.now().toString(),
                code: couponCode,
                name: reward.name,
                type: reward.type,
                value: reward.value,
                maxDiscount: reward.maxDiscount || null,
                used: false,
                createdDate: new Date().toLocaleDateString('th-TH'),
                expiryDate: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toLocaleDateString('th-TH')
            };

            // Update user data
            currentUser.points -= reward.points;
            currentUser.coupons = currentUser.coupons || [];
            currentUser.coupons.push(newCoupon);

            // Update stored user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = { ...currentUser, password: users[userIndex].password };
            }

            saveToStorage();
            updateLoyaltyPage();
            updateAuthUI();

            alert(`üéâ ‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á: ${couponCode}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ`);
        }

        // Initialize the application
        function init() {
            loadFromStorage();
            updateAuthUI();
            showPage('home');
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
